<!doctype html>
<html lang="pt-BR" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Treinos + Timer</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f172a">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <script>tailwind.config = { darkMode: 'class' }</script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 text-slate-100">
<div class="max-w-6xl mx-auto p-4">

<h1 class="text-2xl font-semibold mb-6">Treinos + Timer</h1>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

<!-- CADASTRO -->
<div class="bg-slate-900/40 border border-slate-800 p-4 rounded-2xl">
  <h2 class="font-semibold mb-3">Cadastrar treino</h2>

  <input id="inputNome"
    class="w-full rounded-xl bg-slate-950 border border-slate-800 px-3 py-2 mb-3"
    placeholder="Nome do treino" />

  <textarea id="inputRaw"
    class="w-full rounded-xl bg-slate-950 border border-slate-800 px-3 py-2 min-h-[120px]"
    placeholder="Agachamento | 4x10 | descanso 90"></textarea>

  <div class="flex gap-2 mt-3">
    <button id="btnSalvar"
      class="flex-1 rounded-xl px-4 py-2 bg-emerald-600 hover:bg-emerald-500">
      Salvar
    </button>
    <button id="btnLimpar"
      class="rounded-xl px-4 py-2 bg-slate-800 hover:bg-slate-700">
      Limpar
    </button>
  </div>

  <div class="flex gap-2 mt-3">
    <button id="btnExportar"
      class="flex-1 rounded-xl px-4 py-2 bg-indigo-600 hover:bg-indigo-500">
      Exportar dados
    </button>
    <button id="btnImportar"
      class="flex-1 rounded-xl px-4 py-2 bg-slate-800 hover:bg-slate-700">
      Importar dados
    </button>
  </div>

  <input type="file" id="inputImport" accept="application/json" class="hidden">
</div>

<!-- LISTA -->
<div class="bg-slate-900/40 border border-slate-800 p-4 rounded-2xl">
  <h2 class="font-semibold mb-3">Treinos</h2>
  <div id="listaTreinos"></div>
</div>

</div>
</div>

<script>
const KEY = "treinos_app_v2";

function getTreinos(){
  return JSON.parse(localStorage.getItem(KEY) || "[]");
}

function setTreinos(data){
  localStorage.setItem(KEY, JSON.stringify(data));
}

function parseLinhas(raw){
  return raw.split("\\n").filter(Boolean).map(l => {
    const partes = l.split("|").map(p => p.trim());
    return {
      nome: partes[0] || "Exercício",
      series: 3,
      reps: 10,
      descanso: 60
    }
  });
}

function renderLista(){
  const treinos = getTreinos();
  const host = document.getElementById("listaTreinos");
  host.innerHTML = "";

  treinos.forEach((t,i)=>{
    const div = document.createElement("div");
    div.className="border border-slate-800 p-2 rounded-xl mb-2";
    div.innerHTML = t.nome;
    host.appendChild(div);
  });
}

document.getElementById("btnSalvar").onclick = () => {
  const nome = document.getElementById("inputNome").value;
  const raw = document.getElementById("inputRaw").value;

  if(!nome || !raw) return alert("Preencha os campos");

  const treinos = getTreinos();
  treinos.push({
    nome,
    exercicios: parseLinhas(raw)
  });

  setTreinos(treinos);
  renderLista();
};

document.getElementById("btnLimpar").onclick = () => {
  if(confirm("Apagar todos os dados?")){
    localStorage.removeItem(KEY);
    renderLista();
  }
};

document.getElementById("btnExportar").onclick = () => {
  const dados = localStorage.getItem(KEY);
  if(!dados) return alert("Nada para exportar.");

  const blob = new Blob([dados], {type:"application/json"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "backup_treinos.json";
  a.click();

  URL.revokeObjectURL(url);
};

document.getElementById("btnImportar").onclick = () => {
  document.getElementById("inputImport").click();
};

document.getElementById("inputImport").addEventListener("change", function(){
  const file = this.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(e){
    try{
      const dados = JSON.parse(e.target.result);
      localStorage.setItem(KEY, JSON.stringify(dados));
      alert("Dados importados com sucesso!");
      renderLista();
    }catch{
      alert("Arquivo inválido.");
    }
  };
  reader.readAsText(file);
});

renderLista();
</script>

</body>
</html>
