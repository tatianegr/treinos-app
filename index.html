<!doctype html>
<html lang="pt-BR" class="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Treinos + Timer</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0f172a">
<link rel="icon" href="icons/icon-192.png">

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        pinkshock: '#ff2d8d'
      }
    }
  }
}
</script>
</head>

<body class="bg-slate-950 text-slate-100 pb-24">

<div class="max-w-xl mx-auto p-4">

<!-- HOME -->
<section id="telaHome">
<h1 class="text-2xl font-semibold mb-6">Meus treinos</h1>
<div id="listaTreinos"></div>

<button id="btnNovo"
  class="mt-4 w-full rounded-xl px-4 py-2 bg-pinkshock">
+ Novo treino
</button>
</section>

<!-- CADASTRAR -->
<section id="telaCadastrar" class="hidden">
<h1 class="text-2xl font-semibold mb-6">Novo treino</h1>

<input id="inputNome"
  class="w-full rounded-xl bg-slate-900 border border-slate-800 px-3 py-2 mb-3"
  placeholder="Nome do treino" />

<textarea id="inputRaw"
  class="w-full rounded-xl bg-slate-900 border border-slate-800 px-3 py-2 min-h-[120px]"
  placeholder="Agachamento | 4x10 | descanso 60"></textarea>

<div class="flex gap-2 mt-3">
<button id="btnSalvar"
  class="flex-1 rounded-xl px-4 py-2 bg-pinkshock">
Salvar
</button>
<button id="btnCancelar"
  class="rounded-xl px-4 py-2 bg-slate-800">
Cancelar
</button>
</div>
</section>

<!-- VISUALIZA√á√ÉO -->
<section id="telaVisualizar" class="hidden">
<button id="btnVoltarHome" class="text-sm text-pinkshock mb-4">‚Üê Voltar</button>
<h1 id="tituloTreino" class="text-2xl font-semibold mb-4"></h1>

<div id="listaExerciciosVisual"></div>

<button id="btnIniciar"
  class="mt-4 w-full rounded-xl px-4 py-2 bg-green-600">
INICIAR
</button>
</section>

<!-- EXECU√á√ÉO -->
<section id="telaExecucao" class="hidden">

<div class="sticky top-0 bg-slate-950 py-4 mb-4 border-b border-slate-800">

<div>
<span class="text-sm text-slate-400">Tempo de treino</span>
<div id="timerTotal" class="text-3xl font-bold text-pinkshock">00:00</div>
</div>

<div class="mt-2">
<span class="text-sm text-slate-400">Descanso</span>
<div id="timerDescanso" class="text-xl font-semibold">--:--</div>
</div>

</div>

<div id="listaExerciciosExec"></div>

<button id="btnFinalizar"
  class="mt-4 w-full rounded-xl px-4 py-2 bg-pinkshock">
Finalizar treino
</button>

</section>

</div>

<nav class="fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800">
<div class="max-w-xl mx-auto flex">
<button id="navHome"
  class="flex-1 py-3 text-sm font-medium text-pinkshock">
üè† Home
</button>
<button id="navBackup"
  class="flex-1 py-3 text-sm font-medium text-slate-400">
üíæ Backup
</button>
</div>
</nav>

<script>
const KEY = "treinos_app_final_v2";
let treinoAtual = null;

let totalInterval = null;
let descansoInterval = null;

let totalSegundos = 0;
let descansoSegundos = 0;

function formatar(seg){
  const m = String(Math.floor(seg/60)).padStart(2,"0");
  const s = String(seg%60).padStart(2,"0");
  return `${m}:${s}`;
}

function iniciarTempoTotal(){
  clearInterval(totalInterval);
  totalSegundos = 0;
  document.getElementById("timerTotal").textContent = "00:00";

  totalInterval = setInterval(()=>{
    totalSegundos++;
    document.getElementById("timerTotal").textContent = formatar(totalSegundos);
  },1000);
}

function iniciarDescanso(seg){
  clearInterval(descansoInterval);
  descansoSegundos = seg;
  document.getElementById("timerDescanso").textContent = formatar(seg);

  descansoInterval = setInterval(()=>{
    descansoSegundos--;
    document.getElementById("timerDescanso").textContent = formatar(descansoSegundos);

    if(descansoSegundos<=0){
      clearInterval(descansoInterval);
      document.getElementById("timerDescanso").textContent="--:--";
      navigator.vibrate?.(200);
    }
  },1000);
}

function getTreinos(){
  return JSON.parse(localStorage.getItem(KEY) || "[]");
}

function setTreinos(data){
  localStorage.setItem(KEY, JSON.stringify(data));
}

function parseLinhas(raw){
  return raw.split("\n").filter(Boolean).map(l=>{
    const partes = l.split("|").map(p=>p.trim());
    const match = partes[1]?.match(/(\d+)x(\d+)/);
    return {
      nome: partes[0],
      series: match? Number(match[1]) : 3,
      descanso: partes[2]?.match(/(\d+)/)? Number(partes[2].match(/(\d+)/)[1]) : 60,
      feitas: 0
    };
  });
}

function renderHome(){
  const treinos = getTreinos();
  const host = document.getElementById("listaTreinos");
  host.innerHTML="";

  if(!treinos.length){
    host.innerHTML="<p class='text-slate-400'>Nenhum treino criado.</p>";
    return;
  }

  treinos.forEach((t,i)=>{
    host.innerHTML+=`
      <div class="bg-slate-900 p-3 rounded-xl mb-3">
        <div class="flex justify-between">
          <span>${t.nome}</span>
          <button onclick="abrirTreino(${i})" class="text-pinkshock text-sm">Ver</button>
        </div>
      </div>
    `;
  });
}

function abrirTreino(i){
  treinoAtual = getTreinos()[i];
  document.getElementById("tituloTreino").textContent = treinoAtual.nome;
  mostrar("telaVisualizar");
  renderVisual();
}

function renderVisual(){
  const host = document.getElementById("listaExerciciosVisual");
  host.innerHTML="";
  treinoAtual.exercicios.forEach(e=>{
    host.innerHTML+=`
      <div class="bg-slate-900 p-3 rounded-xl mb-3">
        ${e.nome} ‚Ä¢ ${e.series} s√©ries
      </div>
    `;
  });
}

function iniciarExecucao(){
  iniciarTempoTotal();
  mostrar("telaExecucao");
  renderExecucao();
}

function renderExecucao(){
  const host = document.getElementById("listaExerciciosExec");
  host.innerHTML="";
  treinoAtual.exercicios.forEach((e,i)=>{
    host.innerHTML+=`
      <div class="bg-slate-900 p-3 rounded-xl mb-3">
        <div class="flex justify-between items-center">
          <div>
            ${e.nome}<br>
            <span class="text-sm text-slate-400">${e.feitas}/${e.series}</span>
          </div>
          <button onclick="marcarSerie(${i})"
            class="text-sm px-3 py-1 bg-pinkshock rounded-lg">
            S√©rie feita
          </button>
        </div>
      </div>
    `;
  });
}

function marcarSerie(i){
  const e = treinoAtual.exercicios[i];
  if(e.feitas < e.series){
    e.feitas++;
    iniciarDescanso(e.descanso);
    renderExecucao();
  }
}

function finalizar(){
  clearInterval(totalInterval);
  clearInterval(descansoInterval);
  document.getElementById("timerDescanso").textContent="--:--";
  treinoAtual.exercicios.forEach(e=>e.feitas=0);
  mostrar("telaHome");
  renderHome();
}

function mostrar(id){
  ["telaHome","telaCadastrar","telaVisualizar","telaExecucao"]
  .forEach(t=>document.getElementById(t).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

document.getElementById("btnNovo").onclick=()=>mostrar("telaCadastrar");
document.getElementById("btnCancelar").onclick=()=>mostrar("telaHome");
document.getElementById("btnVoltarHome").onclick=()=>mostrar("telaHome");
document.getElementById("btnIniciar").onclick=iniciarExecucao;
document.getElementById("btnFinalizar").onclick=finalizar;

document.getElementById("btnSalvar").onclick=()=>{
  const nome=document.getElementById("inputNome").value;
  const raw=document.getElementById("inputRaw").value;
  if(!nome||!raw) return alert("Preencha os campos");
  const treinos=getTreinos();
  treinos.push({nome,exercicios:parseLinhas(raw)});
  setTreinos(treinos);
  renderHome();
  mostrar("telaHome");
};

document.getElementById("navHome").onclick=()=>mostrar("telaHome");

document.getElementById("navBackup").onclick=()=>{
  const dados=localStorage.getItem(KEY);
  if(!dados) return alert("Nada para exportar.");
  const blob=new Blob([dados],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="backup_treinos.json";
  a.click();
};

renderHome();
</script>
</body>
</html>
